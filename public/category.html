<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Category - Modern News Platform</title>
    <meta name="description" content="Browse articles by category" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Inter:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      .article-card {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        background: white;
      }
      .article-title {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      .article-excerpt {
        color: #6b7280;
        margin-bottom: 0.5rem;
      }
      .article-meta {
        font-size: 0.875rem;
        color: #9ca3af;
      }
      .category {
        background: #3b82f6;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.75rem;
        margin-right: 0.5rem;
      }

      /* Search and pagination styles */
      .search-container {
        position: relative;
      }

      .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
        margin-top: 2rem;
      }

      .pagination-btn {
        padding: 0.5rem 1rem;
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        background: white;
        color: #374151;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .pagination-btn:hover:not(:disabled) {
        background: #f3f4f6;
        border-color: #9ca3af;
      }

      .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .pagination-btn.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }

      .results-info {
        font-size: 0.875rem;
        color: #6b7280;
        margin-bottom: 1rem;
      }

      @media (max-width: 768px) {
        .pagination-container {
          flex-wrap: wrap;
          gap: 0.25rem;
        }

        .pagination-btn {
          padding: 0.375rem 0.75rem;
          font-size: 0.875rem;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <header class="bg-white shadow-sm border-b">
      <nav class="max-w-6xl mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <a href="/" class="text-2xl font-bold text-blue-600"
            >The News Curator</a
          >
          <ul class="flex space-x-6">
            <li>
              <a href="/" class="text-gray-600 hover:text-blue-600">Home</a>
            </li>
            <li>
              <a
                href="/category.html?category=Politics"
                class="text-gray-600 hover:text-blue-600"
                >Politics</a
              >
            </li>
            <li>
              <a
                href="/category.html?category=Science"
                class="text-gray-600 hover:text-blue-600"
                >Science</a
              >
            </li>
            <li>
              <a
                href="/category.html?category=Technology"
                class="text-gray-600 hover:text-blue-600"
                >Technology</a
              >
            </li>
            <li>
              <a
                href="/category.html?category=Business"
                class="text-gray-600 hover:text-blue-600"
                >Business</a
              >
            </li>
          </ul>
        </div>
      </nav>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-8">
      <section class="mb-8">
        <h1 id="categoryTitle" class="text-3xl font-bold text-gray-900 mb-2">
          Category Articles
        </h1>
        <p id="categoryDescription" class="text-gray-600">
          Browse articles in this category
        </p>

        <!-- Search Bar -->
        <div class="mt-6 max-w-md">
          <div class="relative">
            <input
              type="text"
              id="searchInput"
              placeholder="Search articles..."
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
            <button
              id="searchBtn"
              class="absolute right-2 top-2 px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors"
            >
              Search
            </button>
          </div>
        </div>
      </section>

      <!-- Results Info -->
      <section class="mb-6">
        <div id="resultsInfo" class="text-sm text-gray-600 hidden">
          <span id="resultsCount"></span>
        </div>
      </section>

      <section>
        <div id="categoryGrid" class="space-y-4">
          <div class="text-center py-8">
            <p class="text-gray-500">Loading articles...</p>
          </div>
        </div>

        <!-- Pagination -->
        <div
          id="pagination"
          class="mt-8 flex justify-center items-center space-x-2 hidden"
        >
          <button
            id="prevBtn"
            class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
            disabled
          >
            Previous
          </button>
          <div id="pageNumbers" class="flex space-x-1"></div>
          <button
            id="nextBtn"
            class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
            disabled
          >
            Next
          </button>
        </div>
      </section>
    </main>

    <footer class="bg-gray-800 text-white py-8 mt-12">
      <div class="max-w-6xl mx-auto px-4 text-center">
        <p>&copy; 2024 The News Curator. All rights reserved.</p>
      </div>
    </footer>

    <script>
      // State management
      let currentPage = 1;
      let articlesPerPage = 6;
      let allArticles = [];
      let filteredArticles = [];
      let currentCategory = null;
      let currentSearchQuery = null;

      // Get URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const category = urlParams.get('category');
      const search = urlParams.get('search');
      const page = parseInt(urlParams.get('page')) || 1;

      // Initialize state
      currentPage = page;
      currentCategory = category;
      currentSearchQuery = search;

      // Create article card HTML
      function createArticleCard(article) {
        return `
          <div class="article-card">
            <div class="article-meta">
              <span class="category">${article.category}</span>
              <span>${new Date(article.publishedAt).toLocaleDateString()}</span>
            </div>
            <h3 class="article-title">
              <a href="/article.html?slug=${
                article.slug
              }" class="text-blue-600 hover:text-blue-800">${article.title}</a>
            </h3>
            <p class="article-excerpt">${article.excerpt}</p>
            <div class="article-meta">
              <span>By ${article.author}</span>
              <span>${article.viewCount} views</span>
            </div>
          </div>
        `;
      }

      // Update URL without page reload
      function updateURL() {
        const params = new URLSearchParams();

        if (currentCategory) {
          params.set('category', currentCategory);
        }
        if (currentSearchQuery) {
          params.set('search', currentSearchQuery);
        }
        if (currentPage > 1) {
          params.set('page', currentPage);
        }

        const newURL = `${window.location.pathname}${
          params.toString() ? '?' + params.toString() : ''
        }`;
        window.history.pushState({}, '', newURL);
      }

      // Display articles with pagination
      function displayArticles() {
        const container = document.getElementById('categoryGrid');
        const resultsInfo = document.getElementById('resultsInfo');
        const resultsCount = document.getElementById('resultsCount');

        if (filteredArticles.length === 0) {
          container.innerHTML =
            '<div class="text-center py-8"><p class="text-gray-500">No articles found.</p></div>';
          resultsInfo.classList.add('hidden');
          document.getElementById('pagination').classList.add('hidden');
          return;
        }

        // Calculate pagination
        const totalPages = Math.ceil(filteredArticles.length / articlesPerPage);
        const startIndex = (currentPage - 1) * articlesPerPage;
        const endIndex = startIndex + articlesPerPage;
        const articlesToShow = filteredArticles.slice(startIndex, endIndex);

        // Display articles
        container.innerHTML = articlesToShow
          .map((article) => createArticleCard(article))
          .join('');

        // Update results info
        const startResult = startIndex + 1;
        const endResult = Math.min(endIndex, filteredArticles.length);
        resultsCount.textContent = `Showing ${startResult}-${endResult} of ${filteredArticles.length} articles`;
        resultsInfo.classList.remove('hidden');

        // Update pagination
        updatePagination(totalPages);

        // Update URL
        updateURL();
      }

      // Update pagination controls
      function updatePagination(totalPages) {
        const pagination = document.getElementById('pagination');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageNumbers = document.getElementById('pageNumbers');

        if (totalPages <= 1) {
          pagination.classList.add('hidden');
          return;
        }

        pagination.classList.remove('hidden');

        // Update prev/next buttons
        prevBtn.disabled = currentPage === 1;
        nextBtn.disabled = currentPage === totalPages;

        // Generate page numbers
        pageNumbers.innerHTML = '';
        const maxVisiblePages = 5;
        let startPage = Math.max(
          1,
          currentPage - Math.floor(maxVisiblePages / 2)
        );
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        // Adjust start page if we're near the end
        if (endPage - startPage < maxVisiblePages - 1) {
          startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }

        for (let i = startPage; i <= endPage; i++) {
          const pageBtn = document.createElement('button');
          pageBtn.textContent = i;
          pageBtn.className = `px-3 py-2 rounded ${
            i === currentPage
              ? 'bg-blue-600 text-white'
              : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
          }`;
          pageBtn.addEventListener('click', () => goToPage(i));
          pageNumbers.appendChild(pageBtn);
        }
      }

      // Navigate to specific page
      function goToPage(page) {
        currentPage = page;
        displayArticles();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      // Load articles from API
      async function loadArticles() {
        const container = document.getElementById('categoryGrid');

        try {
          let url = '/api/articles';
          let title = 'All Articles';

          if (currentCategory) {
            url = `/api/categories/${currentCategory}`;
            title = `${currentCategory} Articles`;
          } else if (currentSearchQuery) {
            url = `/api/search?q=${encodeURIComponent(currentSearchQuery)}`;
            title = `Search Results for "${currentSearchQuery}"`;
          }

          document.getElementById('categoryTitle').textContent = title;

          const response = await fetch(url);
          const data = await response.json();

          // Handle different response formats
          allArticles = data.articles || data.results || data;
          filteredArticles = [...allArticles];

          displayArticles();
        } catch (error) {
          console.error('Error loading articles:', error);
          container.innerHTML =
            '<div class="text-center py-8"><p class="text-red-500">Error loading articles.</p></div>';
        }
      }

      // Search functionality
      function performSearch() {
        const searchInput = document.getElementById('searchInput');
        const query = searchInput.value.trim();

        if (query) {
          currentSearchQuery = query;
          currentCategory = null;
          currentPage = 1;
          loadArticles();
        }
      }

      // Clear search and show category or all articles
      function clearSearch() {
        currentSearchQuery = null;
        currentPage = 1;
        document.getElementById('searchInput').value = '';
        loadArticles();
      }

      // Event listeners
      document.addEventListener('DOMContentLoaded', () => {
        // Initialize search input
        if (currentSearchQuery) {
          document.getElementById('searchInput').value = currentSearchQuery;
        }

        // Search button click
        document
          .getElementById('searchBtn')
          .addEventListener('click', performSearch);

        // Search input enter key
        document
          .getElementById('searchInput')
          .addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
              performSearch();
            }
          });

        // Pagination buttons
        document.getElementById('prevBtn').addEventListener('click', () => {
          if (currentPage > 1) {
            goToPage(currentPage - 1);
          }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
          const totalPages = Math.ceil(
            filteredArticles.length / articlesPerPage
          );
          if (currentPage < totalPages) {
            goToPage(currentPage + 1);
          }
        });

        // Load initial articles
        loadArticles();
      });
    </script>
  </body>
</html>
